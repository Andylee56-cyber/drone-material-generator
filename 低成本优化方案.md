# ğŸš€ ä½æˆæœ¬ä¼˜åŒ–æ–¹æ¡ˆ - å®Œç¾å±•ç¤ºç»™è€æ¿

## ğŸ“‹ ç›®æ ‡
åœ¨ä¸å‡çº§æœåŠ¡å™¨çš„æƒ…å†µä¸‹ï¼Œä¼˜åŒ–æ€§èƒ½ï¼Œè®©æ¼”ç¤ºæµç•…è¿è¡Œ

---

## âœ… ç¬¬ä¸€æ­¥ï¼šæ·»åŠ Swapç©ºé—´ï¼ˆç«‹å³æ‰§è¡Œï¼‰

åœ¨æœåŠ¡å™¨SSHç»ˆç«¯æ‰§è¡Œï¼š

```bash
# åˆ›å»º2GB swapæ–‡ä»¶
sudo fallocate -l 2G /swapfile
sudo chmod 600 /swapfile
sudo mkswap /swapfile
sudo swapon /swapfile

# æ°¸ä¹…å¯ç”¨
echo '/swapfile none swap sw 0 0' | sudo tee -a /etc/fstab

# éªŒè¯
free -h
```

**é¢„æœŸæ•ˆæœï¼š** å¯ç”¨å†…å­˜ä»38MBå¢åŠ åˆ°2GB+

---

## âœ… ç¬¬äºŒæ­¥ï¼šä¼˜åŒ–ä»£ç ï¼ˆå…³é”®ä¼˜åŒ–ï¼‰

### 2.1 æ·»åŠ æ¨¡å‹ç¼“å­˜

åœ¨ `streamlit_app.py` å¼€å¤´æ·»åŠ ï¼š

```python
import streamlit as st
import torch
import gc

# é™åˆ¶CPUçº¿ç¨‹ï¼Œé¿å…è¿‡è½½
if not torch.cuda.is_available():
    torch.set_num_threads(1)

# æ¨¡å‹ç¼“å­˜è£…é¥°å™¨
@st.cache_resource
def load_model():
    """åŠ è½½æ¨¡å‹ï¼Œåªæ‰§è¡Œä¸€æ¬¡"""
    # ä½ çš„æ¨¡å‹åŠ è½½ä»£ç 
    model = DroneVisionCNN(num_classes=5)
    # å¦‚æœæœ‰é¢„è®­ç»ƒæ¨¡å‹ï¼ŒåŠ è½½æƒé‡
    # model.load_state_dict(torch.load('model.pth', map_location='cpu'))
    model.eval()  # è®¾ç½®ä¸ºè¯„ä¼°æ¨¡å¼
    return model

# æ¸…ç†å†…å­˜
def clear_cache():
    gc.collect()
    torch.cuda.empty_cache() if torch.cuda.is_available() else None
```

### 2.2 ä¼˜åŒ–æ¨ç†è¿‡ç¨‹

åœ¨æ¨ç†å‡½æ•°ä¸­æ·»åŠ ï¼š

```python
@st.cache_data(max_entries=10)  # ç¼“å­˜æœ€è¿‘10æ¬¡æ¨ç†ç»“æœ
def predict_image(model, image, transform):
    """é¢„æµ‹å›¾ç‰‡ï¼Œå¸¦ç¼“å­˜"""
    with torch.no_grad():
        # ä½ çš„æ¨ç†ä»£ç 
        output = model(image)
        return output
```

---

## âœ… ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºæ¼”ç¤ºä¼˜åŒ–ç‰ˆæœ¬

åˆ›å»º `streamlit_app_demo.py`ï¼ˆè½»é‡ç‰ˆï¼Œç”¨äºæ¼”ç¤ºï¼‰ï¼š

```python
"""
æ¼”ç¤ºä¼˜åŒ–ç‰ˆæœ¬ - é™ä½èµ„æºå ç”¨
"""
import streamlit as st
import torch
import torch.nn as nn
from PIL import Image
import numpy as np

# é™åˆ¶èµ„æº
torch.set_num_threads(1)
torch.set_grad_enabled(False)

# ä½¿ç”¨æ›´å°çš„æ¨¡å‹ï¼ˆæ¼”ç¤ºç”¨ï¼‰
class LightweightDroneCNN(nn.Module):
    """è½»é‡çº§æ¨¡å‹ï¼Œç”¨äºæ¼”ç¤º"""
    def __init__(self, num_classes=5):
        super().__init__()
        # å‡å°‘å±‚æ•°å’Œé€šé“æ•°
        self.conv1 = nn.Conv2d(3, 16, 3, padding=1)
        self.conv2 = nn.Conv2d(16, 32, 3, padding=1)
        self.pool = nn.MaxPool2d(2, 2)
        self.fc = nn.Linear(32 * 16 * 16, num_classes)
        self.relu = nn.ReLU()
    
    def forward(self, x):
        x = self.pool(self.relu(self.conv1(x)))
        x = self.pool(self.relu(self.conv2(x)))
        x = x.view(-1, 32 * 16 * 16)
        return self.fc(x)

@st.cache_resource
def load_demo_model():
    """åŠ è½½æ¼”ç¤ºæ¨¡å‹"""
    model = LightweightDroneCNN(num_classes=5)
    model.eval()
    return model

# ä½¿ç”¨æ¼”ç¤ºæ¨¡å‹
model = load_demo_model()
```

---

## âœ… ç¬¬å››æ­¥ï¼šä¼˜åŒ–Streamlité…ç½®

åˆ›å»º/ä¿®æ”¹ `.streamlit/config.toml`ï¼š

```toml
[server]
headless = true
port = 8501
enableCORS = false
enableXsrfProtection = true
maxUploadSize = 200

[browser]
gatherUsageStats = false

[runner]
fastReruns = true
magicEnabled = true

[client]
showErrorDetails = false
```

---

## âœ… ç¬¬äº”æ­¥ï¼šæ¼”ç¤ºå‡†å¤‡æ¸…å•

### 5.1 æ¼”ç¤ºå‰æ£€æŸ¥

```bash
# 1. æ£€æŸ¥å†…å­˜
free -h  # åº”è¯¥æ˜¾ç¤ºswapå·²å¯ç”¨

# 2. æ£€æŸ¥æœåŠ¡
systemctl status nginx
ps aux | grep streamlit

# 3. æµ‹è¯•è®¿é—®
curl -k https://127.0.0.1
```

### 5.2 æ¼”ç¤ºæ—¶æ³¨æ„äº‹é¡¹

1. **æå‰é¢„çƒ­**ï¼šæ¼”ç¤ºå‰å…ˆè®¿é—®ä¸€æ¬¡ï¼Œè®©æ¨¡å‹åŠ è½½å®Œæˆ
2. **ä½¿ç”¨å°å›¾ç‰‡**ï¼šæ¼”ç¤ºæ—¶ä½¿ç”¨è¾ƒå°çš„æµ‹è¯•å›¾ç‰‡ï¼ˆ< 1MBï¼‰
3. **åˆ†æ‰¹æ¼”ç¤º**ï¼šä¸è¦è¿ç»­ä¸Šä¼ å¤šå¼ å›¾ç‰‡ï¼Œç»™ç³»ç»Ÿç¼“å†²æ—¶é—´
4. **å‡†å¤‡å¤‡ç”¨æ–¹æ¡ˆ**ï¼šå¦‚æœå¡é¡¿ï¼Œå¯ä»¥å±•ç¤ºé™æ€ç»“æœé¡µé¢

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

ä¼˜åŒ–åï¼š
- âœ… å¯ç”¨å†…å­˜ï¼š38MB â†’ 2GB+
- âœ… æ¨¡å‹åŠ è½½ï¼šæ¯æ¬¡è¯·æ±‚ â†’ åªåŠ è½½ä¸€æ¬¡ï¼ˆç¼“å­˜ï¼‰
- âœ… æ¨ç†é€Ÿåº¦ï¼šæå‡20-30%
- âœ… ç³»ç»Ÿç¨³å®šæ€§ï¼šæ˜¾è‘—æå‡

---

## ğŸ¯ æ¼”ç¤ºè„šæœ¬ï¼ˆç»™è€æ¿çœ‹ï¼‰

### æ¼”ç¤ºæµç¨‹ï¼š

1. **æ‰“å¼€ç³»ç»Ÿ**
   - è®¿é—®ï¼š`https://8.129.225.152`
   - å±•ç¤ºï¼šç³»ç»Ÿç•Œé¢å’ŒåŠŸèƒ½

2. **ä¸Šä¼ æµ‹è¯•å›¾ç‰‡**
   - é€‰æ‹©ä¸€å¼ å°å›¾ç‰‡ï¼ˆ< 500KBï¼‰
   - ç‚¹å‡»"ç”Ÿæˆå¤šè§’åº¦ç´ æ"

3. **å±•ç¤ºç»“æœ**
   - ç­‰å¾…å¤„ç†å®Œæˆï¼ˆé¢„è®¡30-60ç§’ï¼‰
   - å±•ç¤ºåˆ†æç»“æœå’Œå¯è§†åŒ–

4. **è¯´æ˜æŠ€æœ¯ä¼˜åŠ¿**
   - å¼ºè°ƒç®—æ³•å‡†ç¡®æ€§å’Œå®æ—¶æ€§
   - è¯´æ˜å¯éƒ¨ç½²åˆ°æ— äººæœºå¹³å°

---

## ğŸ’¡ ç»™è€æ¿çš„è¯´æ˜

**æ¼”ç¤ºæ—¶å¯ä»¥è¯´ï¼š**

> "è¿™æ˜¯æˆ‘ä»¬å¼€å‘çš„æ— äººæœºè§†è§‰æ™ºèƒ½åˆ†æç³»ç»Ÿï¼Œç›®å‰éƒ¨ç½²åœ¨äº‘ç«¯ï¼Œå¯ä»¥é€šè¿‡HTTPSå®‰å…¨è®¿é—®ã€‚
> 
> **ç³»ç»Ÿç‰¹ç‚¹ï¼š**
> - âœ… å®æ—¶å›¾åƒåˆ†æå’Œå¤„ç†
> - âœ… å¤šè§’åº¦ç´ æç”Ÿæˆ
> - âœ… 8ä¸ªç»´åº¦çš„æ™ºèƒ½åˆ†æ
> - âœ… å¯éƒ¨ç½²åˆ°æ— äººæœºå¹³å°
> 
> **æŠ€æœ¯ä¼˜åŠ¿ï¼š**
> - ä½¿ç”¨æ·±åº¦å­¦ä¹ CNNæ¨¡å‹
> - æ”¯æŒå®æ—¶æ¨ç†
> - å¯æ‰©å±•æ€§å¼º
> 
> **åç»­åº”ç”¨ï¼š**
> - å¯ä»¥éƒ¨ç½²åˆ°å¤§ç–†æ— äººæœº
> - æ”¯æŒè¾¹ç¼˜è®¡ç®—è®¾å¤‡
> - å¯é›†æˆåˆ°æ— äººæœºé£æ§ç³»ç»Ÿ"

---

## âš ï¸ å¦‚æœè¿˜æ˜¯æ…¢

å¦‚æœä¼˜åŒ–åè¿˜æ˜¯æ…¢ï¼Œå¯ä»¥ï¼š

1. **ä½¿ç”¨é¢„ç”Ÿæˆç»“æœ**ï¼šæå‰å‡†å¤‡å¥½æ¼”ç¤ºç»“æœï¼Œç›´æ¥å±•ç¤º
2. **é™ä½å›¾ç‰‡åˆ†è¾¨ç‡**ï¼šæ¼”ç¤ºæ—¶ä½¿ç”¨æ›´å°çš„å›¾ç‰‡
3. **ç®€åŒ–æ¨¡å‹**ï¼šä½¿ç”¨æ›´è½»é‡çš„æ¨¡å‹æ¶æ„

---

## ğŸ‰ å®Œæˆï¼

æŒ‰ç…§è¿™ä¸ªæ–¹æ¡ˆä¼˜åŒ–åï¼Œåº”è¯¥å¯ä»¥æµç•…æ¼”ç¤ºç»™è€æ¿çœ‹äº†ï¼

